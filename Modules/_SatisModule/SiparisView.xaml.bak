<UserControl xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:dxb="http://schemas.devexpress.com/winfx/2008/xaml/bars"
    xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
    xmlns:s="clr-namespace:System;assembly=mscorlib"
    xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
    xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
    xmlns:dxlc="http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"
    xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dxgt="http://schemas.devexpress.com/winfx/2008/xaml/grid/themekeys"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             

    xmlns:Serialization="clr-namespace:DevExpress.Xpf.LayoutControl.Serialization;assembly=DevExpress.Xpf.LayoutControl.v20.1"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:converters="clr-namespace:Pandap.UI.Converters"

    xmlns:fa="http://schemas.fontawesome.io/icons/"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:siparisKalem="clr-namespace:Pandap.UI.Modules._SatisModule"
             xmlns:controlHelpers="clr-namespace:Pandap.UI.ControlHelpers"
             TextElement.Foreground="{DynamicResource MaterialDesignBody}"
             TextElement.FontWeight="Regular"
             TextElement.FontSize="13"

             TextOptions.TextFormattingMode="Ideal"
             TextOptions.TextRenderingMode="Auto"
             Background="{DynamicResource MaterialDesignPaper}"
             FontFamily="{DynamicResource MaterialDesignFont}"
             
             x:Class="Pandap.UI.Modules._SatisModule.SiparisView"
    x:Name="siparisform"

    mc:Ignorable="d" d:DesignWidth="1262.2" d:DesignHeight="742.8"
   d:DataContext="{d:DesignInstance siparisKalem:SiparisViewModel}">

    <UserControl.Resources>

        <DataTemplate DataType="{x:Type siparisKalem:KalemViewModel}">
            <siparisKalem:KalemView />
        </DataTemplate>

        <converters:MyEmptyOrNullConverter x:Key="myEmptyNullConverter" />
        <converters:MyBoolToVisibilityConverter x:Key="myBoolToVisibilityConverter" />


        <converters:MyVisibilityFromCountConverter x:Key="myVisibilityFromCountConverter" />
        

        <Style TargetType="dxe:SpinEdit">
            <Setter Property="IsFloatValue" Value="False" />
            <Setter Property="EditValueType" Value="{x:Type sys:Int32}" />
        </Style>

        <Style x:Key="grpSiparis" TargetType="dxlc:GroupBox">
            <Setter Property="TitleVisibility" Value="Collapsed" />
            <Setter Property="BorderThickness" Value="0.3" />
        </Style>


        <Style x:Key="BaseStyle" TargetType="dxe:BaseEdit">
            <Style.Triggers>
                <Trigger Property="IsReadOnly" Value="True">
                    <Setter Property="Background" Value="#F4F4F4" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="dxe:TextEdit" BasedOn="{StaticResource BaseStyle}" />
        <Style TargetType="dxe:ComboBoxEdit" BasedOn="{StaticResource BaseStyle}" />

        <Style x:Key="fiyatColumnSitil" TargetType="{x:Type dxg:BaseGridHeader }">
            <Setter Property="Background" Value="LightCoral" />
            <Setter Property="Foreground" Value="#FFFFFF" />
        </Style>


        <Style x:Key="kapasitifKey" TargetType="StackPanel">
            <Style.Triggers>
                <DataTrigger Binding="{Binding KapasitifMi}" Value="True">
                    <Setter Property="Background" Value="LightGray" />
                </DataTrigger>
            </Style.Triggers>

        </Style>

    </UserControl.Resources>

    <dxmvvm:Interaction.Behaviors>
        <dxmvvm:CurrentWindowService />
        <dx:DXMessageBoxService />
        <dx:DialogService DialogWindowStartupLocation="CenterOwner" x:Name="Service1">
            <dx:DialogService.DialogStyle>
                <Style TargetType="{x:Type dx:DXDialogWindow}">
                    <Setter Property="WindowStyle" Value="ToolWindow" />
                </Style>
            </dx:DialogService.DialogStyle>
        </dx:DialogService>

        <dxmvvm:EventToCommand SourceName="siparisform" EventName="Loaded" Command="{Binding FormLoadedCommand}" />

        <dxmvvm:CurrentWindowService ClosingCommand="{Binding FormClosingCommand}" />
    </dxmvvm:Interaction.Behaviors>

    <DockPanel>

        <ToolBarTray DockPanel.Dock="Top">
            <ToolBar Height="40" IsEnabled="{Binding IsEditableForm, Mode=TwoWay}">
                

                <ToggleButton Style="{x:Null}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Width="32" Height="32" Foreground="DarkOrange" VerticalAlignment="Center" Kind="FileDocument" />
                            <TextBlock Margin="8 0 8 0" FontSize="14" FontWeight="DemiBold" VerticalAlignment="Center" Text="Yeni Sipariş" />
                        </StackPanel>

                        <Popup StaysOpen="false" IsOpen="{Binding IsChecked, RelativeSource={RelativeSource AncestorType={x:Type ToggleButton}}}" 
                                PlacementTarget="{Binding RelativeSource={RelativeSource AncestorType={x:Type ToggleButton}}}">

                            <Border Padding="5" Background="White" BorderThickness="1" BorderBrush="Gray">
                                <StackPanel>
                                    <Button HorizontalContentAlignment="Left" Padding="3" Command="{Binding SiparisYeniCommand}" 
                                            Style="{DynamicResource MaterialDesignFlatButton}">

                                        <Button.CommandParameter>
                                            <s:Boolean>False</s:Boolean>
                                        </Button.CommandParameter>

                                        <StackPanel Orientation="Horizontal">
                                            <Image Source="{dx:DXImage Image=AddFile_32x32.png}" />
                                            <TextBlock VerticalAlignment="Center" Text="Sipariş" />
                                        </StackPanel>
                                    </Button>

                                    <Button HorizontalContentAlignment="Left" Padding="3" Command="{Binding SiparisYeniCommand}" 
                                            Style="{DynamicResource MaterialDesignFlatButton}">
                                        <Button.CommandParameter>
                                            <s:Boolean>True</s:Boolean>
                                        </Button.CommandParameter>

                                        <StackPanel Orientation="Horizontal">
                                            <Image Source="{dx:DXImage Image=SelectTable_32x32.png}" />
                                            <TextBlock VerticalAlignment="Center" Text="Kapasitif Sipariş" />
                                        </StackPanel>
                                    </Button>

                                    <Button HorizontalContentAlignment="Left" Padding="3" Command="{Binding SiparisKapasitiftenYeniCommand}" 
                                            Style="{DynamicResource MaterialDesignFlatButton}">
                                        <StackPanel Orientation="Horizontal">
                                            <Image Source="{dx:DXImage Image=NewTableStyle_32x32.png}" />
                                            <TextBlock VerticalAlignment="Center" Text="Kapasitiften Yeni" />
                                        </StackPanel>
                                    </Button>

                                </StackPanel>
                            </Border>
                        </Popup>
                    </StackPanel>

                </ToggleButton>


                <Button Padding="3" Command="{Binding SiparisKopyalaCommand}">
                    <StackPanel Orientation="Horizontal">
                        <Image Source="{dx:DXImage Image=Copy_32x32.png}" />
                        <TextBlock VerticalAlignment="Center" Text="Kopyadan Yeni" />
                    </StackPanel>
                </Button>

                <Button Padding="3" Command="{Binding SiparisKaydetCommand}">
                    <StackPanel Orientation="Horizontal">
                        <Image Source="{dx:DXImage Image=Save_32x32.png}" />
                        <TextBlock VerticalAlignment="Center" Text="Kaydet" />
                    </StackPanel>
                </Button>

               
                <Button Padding="3" controlHelpers:VisibilityHelpler.IsVisible="{DXBinding 'YurtDisiSatisMi'}"
                    Command="{Binding TeyitFormYazdirEnCommand}">
                    <StackPanel Orientation="Horizontal">
                        <Image Height="23" Source="pack://application:,,,/Pandap;component/Content/Images/en.JPG" />
                        <TextBlock VerticalAlignment="Center" Text="Teyit Formu EN" />
                    </StackPanel>
                </Button>

                <Button controlHelpers:VisibilityHelpler.IsVisible="{DXBinding '!YurtDisiSatisMi'}"
                    Padding="3" Command="{Binding TeyitFormYazdirTrCommand}">
                    <StackPanel Orientation="Horizontal">
                        <Image Height="23" Source="pack://application:,,,/Pandap;component/Content/Images/tr.JPG" />
                        <TextBlock VerticalAlignment="Center" Text="Teyit Formu TR" />
                    </StackPanel>
                </Button>

             


                <Button Padding="3" Command="{Binding VerileriTazeleCommand}">
                    <StackPanel Orientation="Horizontal">
                        <Image Source="{dx:DXImage Image=RefreshAllPivotTable_32x32.png}" />
                        <TextBlock VerticalAlignment="Center" Text="Ekranı Tazele" />
                    </StackPanel>
                </Button>

                <!--<Button Margin="20,0,0,0" DataContext="{Binding SeciliSiparis}" 
                        Style="{StaticResource MesajButon}" Padding="3" Command="{Binding SiparisMesajYazCommand}" >

                </Button>-->

            </ToolBar>

            <ToolBar>
                <StackPanel DataContext="{Binding}" Height="25" Orientation="Horizontal">

                    <TextBlock Padding="5,0" VerticalAlignment="Center" FontWeight="Bold" Text="Versiyonlar:" />

                    <dxe:ComboBoxEdit IsTextEditable="False" ApplyItemTemplateToSelectedItem="True" Width="220"

                            ItemsSource="{Binding DataContext.EntityLogs,ElementName=siparisform}"
                            SelectedItem="{Binding DataContext.SeciliEntityLog,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged,
                                ElementName=siparisform}">

                        <dxe:ComboBoxEdit.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Padding="5,0" Text="{Binding Path=KayitTarihi,StringFormat={}{0:dd/MM/yyyy hh:mm:ss}}" MinHeight="0" />
                                    <TextBlock Text="{Binding Path=KullaniciAdSoyad}" MinHeight="0" />
                                </StackPanel>
                            </DataTemplate>
                        </dxe:ComboBoxEdit.ItemTemplate>
                    </dxe:ComboBoxEdit>
                </StackPanel>
            </ToolBar>

        </ToolBarTray>

        <materialDesign:Card Padding="0" Margin="5" VerticalAlignment="Stretch" materialDesign:ShadowAssist.ShadowDepth="Depth1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="auto" />
                </Grid.RowDefinitions>

                <Grid materialDesign:ShadowAssist.ShadowDepth="Depth0" Margin="5">
                    <StackPanel Name="SiparişBilgi" Style="{StaticResource kapasitifKey}" DataContext="{Binding SeciliSiparis}">
                        <StackPanel.Resources>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontWeight" Value="Bold" />
                                <Setter Property="TextAlignment" Value="Right" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                            </Style>

                            <Style TargetType="DockPanel">
                                <Setter Property="Margin" Value="0,3" />
                            </Style>
                        </StackPanel.Resources>


                        <StackPanel Margin="0,0,0,10" Orientation="Horizontal">

                            <DockPanel>
                                <TextBlock Width="100" Text="Sipariş No : " />
                                <dxe:TextEdit IsReadOnly="True" IsTabStop="False" ShowBorder="False" FontSize="13" Width="150"
                                  Text="{Binding SiparisKod,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" FontWeight="Bold" Foreground="DarkRed" />
                            </DockPanel>

                            <DockPanel>
                                <TextBlock Text="Tarih : " />
                                <StackPanel Orientation="Horizontal">
                                    <dxe:TextEdit ShowBorder="False" IsReadOnly="True" Width="100"
                                  EditValue="{Binding SiparisTarih, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                  FontWeight="Bold" Foreground="DarkRed" DisplayFormatString="d" />
                                </StackPanel>
                            </DockPanel>

                            <DockPanel controlHelpers:VisibilityHelpler.IsVisible="{Binding KapasitiftenYeniMi}">
                                <TextBlock Text="Kapasitif Kod: " FontWeight="Bold" Foreground="DarkRed" />
                                <Button Style="{StaticResource MyLinkButton1}" 
                                        Command="{Binding DataContext.SiparisEditCommand,ElementName=siparisform}" CommandParameter="{Binding IlgiliKapasitifSiparisKod}"
                                        Content="{Binding IlgiliKapasitifSiparisKod}" />
                            </DockPanel>


                            <dxe:ToggleSwitchEdit Margin="100,0,0,0" EditValue="{Binding KalemToleranslariStandartDisiMi,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                                UncheckedStateContent="Kalem Toleransları Standart"
                                                CheckedStateContent="Kalem Toleransları Standart Dışı" ContentPlacement="Far" />

                        </StackPanel>
                        <StackPanel Margin="0,0,0,5" Orientation="Horizontal">
                            <DockPanel>
                                <TextBlock Width="100" Text="Müşteri : " />
                                <dxg:LookUpEdit Width="400" HorizontalAlignment="Left" AutoPopulateColumns="False"
                            DisplayMember="CariIsim"
                            EditValue="{Binding CariKod,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                            SelectedItem="{Binding DataContext.SeciliMusteri, Mode=OneWayToSource, UpdateSourceTrigger=PropertyChanged,
                                    RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}"
                            ItemsSource="{Binding DataContext.Musteriler, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}"
                            ValueMember="CariKod">

                                    <dxg:LookUpEdit.StyleSettings>
                                        <dxg:SearchLookUpEditStyleSettings />
                                    </dxg:LookUpEdit.StyleSettings>
                                    <dxg:LookUpEdit.PopupContentTemplate>
                                        <ControlTemplate>
                                            <dxg:GridControl x:Name="PART_GridControl">
                                                <dxg:GridControl.View>
                                                    <dxg:TableView SearchPanelCriteriaOperatorType="And" AutoWidth="False" />
                                                </dxg:GridControl.View>
                                                <dxg:GridColumn Width="100" FieldName="CariKod" />
                                                <dxg:GridColumn Width="*" FieldName="CariIsim" />
                                                <dxg:GridColumn Width="30" FieldName="UlkeKod" />
                                                <dxg:GridColumn Width="50" FieldName="PlasiyerKod" />
                                            </dxg:GridControl>
                                        </ControlTemplate>
                                    </dxg:LookUpEdit.PopupContentTemplate>
                                </dxg:LookUpEdit>
                                
                                <DockPanel Margin="-70,0,0,0">
                                    <TextBlock HorizontalAlignment="Left" Margin="0" Padding="0" Text="{Binding SatisTipKod}" />
                                </DockPanel>
                            </DockPanel>

                            <DockPanel Margin="10,0,0,0">
                                <TextBlock HorizontalAlignment="Left" Text="Müş.Sip. No: " />
                                <dxe:TextEdit Width="100" EditValue="{Binding FirmaSiparisNo,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" />
                            </DockPanel>

                            <DockPanel Height="25" Margin="10,0,0,0" Background="LightPink">
                                <TextBlock Padding="2" HorizontalAlignment="Left" Text="Sevk Haftası : " />
                                <UniformGrid Rows="1">
                                    <dxe:TextEdit EditValue="{Binding SevkYil,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" />
                                    <dxe:SpinEdit EditValue="{Binding SevkHafta,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged,ValidatesOnNotifyDataErrors=True}" />
                                </UniformGrid>

                            </DockPanel>

                            <DockPanel Height="25" Margin="10,0,0,0" Background="LightPink">
                                <TextBlock Padding="2" HorizontalAlignment="Left" Text="Teslim Haftası : " />
                                <UniformGrid Rows="1">
                                    <dxe:TextEdit EditValue="{Binding TeslimYil,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" />
                                    <dxe:SpinEdit EditValue="{Binding TeslimHafta,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged,ValidatesOnNotifyDataErrors=True}" />
                                </UniformGrid>
                            </DockPanel>


                        </StackPanel>
                        <StackPanel Orientation="Horizontal">

                            <DockPanel>
                                <TextBlock Width="100" Text="Ödeme Şekli : " />
                                <dxe:ComboBoxEdit AutoComplete="True"
                            Width="150"
                            DisplayMember="Aciklama"
                            EditValue="{Binding OdemeTipKod,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                            ItemsSource="{Binding DataContext.OdemeTipleri, ElementName=siparisform}"
                            ValueMember="OdemeTipKod" />
                            </DockPanel>

                            <DockPanel>
                                <TextBlock Margin="8,0,0,0" HorizontalAlignment="Left" Text="Ödeme Not : " />
                                <dxe:TextEdit Width="150"
                                  EditValue="{Binding OdemeAciklama,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" />
                            </DockPanel>
                            
                            <DockPanel Width="280">
                                <TextBlock Width="120" Text="Teslim Şekli : " />
                                <dxe:ComboBoxEdit AutoComplete="True"
                            DisplayMember="Aciklama"
                            EditValue="{Binding TeslimTipKod, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            ItemsSource="{Binding DataContext.TeslimTipleri, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}"
                            ValueMember="TeslimTipKod" />
                            </DockPanel>

                            <DockPanel>
                                <TextBlock Width="120" Text="Fatura Döviz C. : " />
                                <dxe:ComboBoxEdit Width="70" AutoComplete="True"
                            DisplayMember="Aciklama"
                            EditValue="{Binding FaturaDovizTipKod,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                            ItemsSource="{Binding DataContext.DovizTipleri, RelativeSource={RelativeSource AncestorType=UserControl}}"
                            ValueMember="DovizTipKod" />



                            </DockPanel>



                        </StackPanel>
                        <StackPanel Margin="0,10,0,0" Orientation="Horizontal">
                            <DockPanel>
                                <TextBlock Width="100" Text="Lme Durum : " />
                                <dxe:ComboBoxEdit AutoComplete="True"
                            Width="150"
                            DisplayMember="Aciklama"
                            EditValue="{Binding LmeDurumKod,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                            ItemsSource="{Binding DataContext.LmeBaglamaTipleri, ElementName=siparisform}"
                            ValueMember="LmeTipKod" />
                            </DockPanel>

                            <DockPanel Height="22" Margin="10,0,0,0">
                                <TextBlock HorizontalAlignment="Left" Text="LME Metni : " />
                                <dxe:TextEdit Width="200" EditValue="{Binding LmeBaglamaNot, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                            </DockPanel>


                            <DockPanel>
                                <TextBlock Width="120" Text="LME Döviz C. : " />
                                <dxe:ComboBoxEdit Width="70" AutoComplete="True"
                            DisplayMember="Aciklama"
                            EditValue="{Binding TakipDovizTipKod,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                ItemsSource="{Binding DataContext.DovizTipleri, RelativeSource={RelativeSource AncestorType=UserControl}}"
                            ValueMember="DovizTipKod" />
                            </DockPanel>

                      

                        </StackPanel>

                    </StackPanel>
                </Grid>

                <materialDesign:Card materialDesign:ShadowAssist.ShadowDepth="Depth1" Margin="2" Padding="0" VerticalAlignment="Stretch" Grid.Row="1">
                    <DockPanel Name="Kalemler">

                        <StackPanel DockPanel.Dock="Top">
                            <ToolBarTray Background="White" VerticalAlignment="Center" IsEnabled="{Binding IsEditableForm, Mode=TwoWay}" Margin="0,0">
                                <ToolBar Background="White">
                                    <Button Padding="8" Command="{Binding KalemYeniCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <Image Source="{dx:DXImage Image=ShowDetail_16x16.png}" />
                                            <TextBlock VerticalAlignment="Center" Text="Yeni Kalem" />
                                        </StackPanel>
                                    </Button>


                                    <Button Padding="8" Command="{Binding KalemKaydetCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <Image Source="{dx:DXImageOffice2013 Image=SaveTo_16x16.png}" />
                                            <TextBlock VerticalAlignment="Center" Text="Ekle/Güncelle" />
                                        </StackPanel>
                                    </Button>

                                    <Button Padding="8" Command="{Binding KalemKopyalaCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <Image Source="{dx:DXImageOffice2013 Image=Copy_16x16.png}" />
                                            <TextBlock VerticalAlignment="Center" Text="Kalem Kopyala" />
                                        </StackPanel>
                                    </Button>


                                    <Button Padding="8" Command="{Binding KalemEditCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <Image Source="{dx:DXImage Image=PenColor_16x16.png}" />
                                            <TextBlock VerticalAlignment="Center" Text="Düzenle" />
                                        </StackPanel>
                                    </Button>

                                    <Button Padding="8" Command="{Binding KalemSilCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <Image Source="{dx:DXImageOffice2013 Image=Delete_16x16.png}" />
                                            <TextBlock Width="50" TextAlignment="Center" VerticalAlignment="Center" Text="Sil" />
                                        </StackPanel>
                                    </Button>

                                    <Button Padding="8" Command="{Binding KalemVazgecCommand}">
                                        <StackPanel Orientation="Horizontal">
                                            <Image Source="{dx:DXImage Image=Reset_16x16.png}" />
                                            <TextBlock VerticalAlignment="Center" Text="İptal" />
                                        </StackPanel>
                                    </Button>





                                </ToolBar>

                                <ToolBar Background="White">


                                    <dx:DropDownButton x:Name="d1" 
                                           IsPopupOpen="{Binding DataContext.LmeIsPopupOpen,ElementName=siparisform,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                           VerticalAlignment="Center" Margin="20,0" Content="LME Bağla">

                                        <StackPanel>
                                            <Grid Margin="5">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition />
                                                    <ColumnDefinition />
                                                </Grid.ColumnDefinitions>

                                                <StackPanel Grid.Column="0">
                                                    <TextBlock FontWeight="Bold" TextAlignment="Center" Text="Sipariş Lfx Bakiye" />
                                                    <TextBlock TextAlignment="Center" Text="{Binding DataContext.SeciliLme.SiparisLfx_Bakiye_kg,UpdateSourceTrigger=PropertyChanged, ElementName=siparisform,StringFormat={}{0:n0}}" />
                                                </StackPanel>

                                                <StackPanel Grid.Column="1">
                                                    <TextBlock FontWeight="Bold" TextAlignment="Center" Text="Atanacak Lme:" />
                                                    <TextBlock TextAlignment="Center" Text="{Binding DataContext.LmeSeciliTonajMiktari,ElementName=siparisform,StringFormat={}{0:n0}}" />
                                                </StackPanel>

                                                <StackPanel Grid.Column="2">
                                                    <TextBlock FontWeight="Bold" TextAlignment="Center" Text="Yeni Sip Lfx Bakiye" />
                                                    <TextBlock TextAlignment="Center" Text="{Binding DataContext.LmeBaglamaFark, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged, ElementName=siparisform,StringFormat={}{0:n0}}" />
                                                </StackPanel>
                                            </Grid>

                                            <TextBlock Padding="5" Text="{Binding DataContext.LmeMesaj,ElementName=siparisform, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" />

                                            <dxe:ListBoxEdit HorizontalAlignment="Stretch" MaxHeight="400" HorizontalContentAlignment="Stretch"
                                    DisplayMember="RefNo"
                                    SelectedItem="{Binding DataContext.SeciliLme,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged,RelativeSource={RelativeSource AncestorType=UserControl}}"
                                    ItemsSource="{Binding DataContext.LmeBaglamaListe, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged, RelativeSource={RelativeSource AncestorType=UserControl}}">

                                                <dxe:ListBoxEdit.ItemContainerStyle>
                                                    <Style TargetType="dxe:ListBoxEditItem">
                                                        <Setter Property="Template">
                                                            <Setter.Value>
                                                                <ControlTemplate TargetType="dxe:ListBoxEditItem">
                                                                    <Border Name="MainBorder" BorderThickness="2" BorderBrush="Gray" Background="Transparent">
                                                                        <StackPanel>
                                                                            <ContentPresenter />
                                                                        </StackPanel>
                                                                    </Border>

                                                                    <ControlTemplate.Triggers>

                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                            <Setter TargetName="MainBorder" Property="BorderBrush" Value="Red" />
                                                                        </Trigger>
                                                                    </ControlTemplate.Triggers>
                                                                </ControlTemplate>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Style>
                                                </dxe:ListBoxEdit.ItemContainerStyle>

                                                <dxe:ListBoxEdit.ItemTemplate>
                                                    <DataTemplate>

                                                        <Border BorderThickness="1" BorderBrush="Gray">
                                                            <Grid Margin="4">
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="2*" />
                                                                    <ColumnDefinition Width="*" />

                                                                </Grid.ColumnDefinitions>

                                                                <StackPanel Grid.Column="0">
                                                                    <StackPanel Orientation="Horizontal">
                                                                        <TextBlock FontWeight="Bold" Text="Kod : " />
                                                                        <TextBlock Text="{Binding RefNo}" />

                                                                        <TextBlock FontWeight="Bold" Margin="10,0,0,0" Text="SiparisLfx Bakiye :" />
                                                                        <TextBlock Text="{Binding SiparisLfx_Bakiye_kg,StringFormat={}{0:n0}}" />
                                                                    </StackPanel>
                                                                    <StackPanel Orientation="Horizontal">
                                                                        <TextBlock Text="SevkAyi : " />
                                                                        <TextBlock Text="{Binding SevkAyi}" />
                                                                    </StackPanel>

                                                                    <StackPanel Orientation="Horizontal">
                                                                        <TextBlock Text="Lme Deger : " />
                                                                        <TextBlock Text="{Binding LmeDeger,StringFormat={}{0:n0}}" />
                                                                    </StackPanel>

                                                                    <StackPanel Orientation="Horizontal">
                                                                        <TextBlock Text="Baglanti Miktari : " />
                                                                        <TextBlock Text="{Binding BaglantiLfx_kg,StringFormat={}{0:n0}}" />
                                                                    </StackPanel>

                                                                    <StackPanel Orientation="Horizontal">
                                                                        <TextBlock Text="Baglanti Tarihi :" />
                                                                        <TextBlock Text="{Binding BaglantiTarihi,StringFormat='{}{0:dd/MM/yyyy}'}" />
                                                                    </StackPanel>

                                                                    <StackPanel Visibility="{Binding KilitliMi, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, 
                                                            Converter={converters:MyBoolToVisibilityConverter}}" Orientation="Horizontal">
                                                                        <TextBlock>
                                                                     <fa:ImageAwesome Width="30" Height="30" Foreground="Red" Icon="Lock" />
                                                                        </TextBlock>
                                                                    </StackPanel>



                                                                </StackPanel>


                                                                <Button Grid.Column="1" Margin="6" Content="Lme Bağla" x:Name="cmdLmeBagla" Visibility="Hidden"
                                                    Command="{Binding DataContext.LmeBaglaCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}">
                                                                </Button>
                                                            </Grid>
                                                        </Border>

                                                        <DataTemplate.Triggers>
                                                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType={x:Type dxe:ListBoxEditItem},
                                                    Mode=FindAncestor}}" Value="True">
                                                                <Setter TargetName="cmdLmeBagla" Property="Visibility" Value="Visible" />
                                                            </DataTrigger>

                                                        </DataTemplate.Triggers>

                                                    </DataTemplate>
                                                </dxe:ListBoxEdit.ItemTemplate>


                                            </dxe:ListBoxEdit>


                                            <dx:SimpleButton HorizontalContentAlignment="Center" Padding="0" Margin="10"  
                                                         Style="{StaticResource MyLinkButtonAc}" Content="Lme Listesisini Aç"
                                         Command="{Binding DataContext.LmeListeFormAcCommand, ElementName=siparisform}" />
                                        </StackPanel>

                                    </dx:DropDownButton>

                             

                                </ToolBar>

                            </ToolBarTray>

                            <ContentControl Content="{Binding KalemVM, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                        </StackPanel>


                        <dxg:GridControl AllowLiveDataShaping="True" Margin="5" MaxHeight="1500" SelectionMode="Cell"
                                     SelectedItem="{Binding SeciliKalem,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" 
                                 ItemsSource="{Binding SeciliSiparis.SiparisKalemleri}"
                                  VerticalAlignment="Stretch">

                            <dxg:GridControl.Resources>
                                
                                <Style TargetType="dxg:GridColumnHeader">
                                    <Setter Property="Background" Value="LightSkyBlue" />
                                </Style>
                            </dxg:GridControl.Resources>

                            <dxg:GridControl.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Yeni Satır (insert)" Command="{Binding KalemYeniCommand}" />
                                    <MenuItem Header="Satır Sil (delete)" Command="{Binding KalemSilCommand}" />
                                    <MenuItem Header="Satır Kopyala" Command="{Binding KalemKopyalaCommand}" />
                                    <MenuItem Header="Satır Detay (F4)" Command="{Binding KalemEditCommand}" />
                                </ContextMenu>
                            </dxg:GridControl.ContextMenu>

                            <dxg:GridControl.View>

                                <dxg:TableView AutoWidth="True" AllowGrouping="False" ShowGroupPanel="False" ShowFixedTotalSummary="False" 
                                            ShowTotalSummary="True" AllowEditing="False"
                                                    IsDetailButtonVisibleBinding="{DXBinding 'Row.Paletler.Count &gt; 0'}">
                                    <dxg:TableView.FormatConditions>

                                        <dxg:FormatCondition FieldName="OPER_NetsisBelgeNo" Value1="{x:Null}" ValueRule="NotEqual">
                                            <dx:Format Background="Green" Foreground="White" TextDecorations="{x:Null}" />
                                        </dxg:FormatCondition>
                                    </dxg:TableView.FormatConditions>


                                    <dxg:TableView.ColumnHeaderTemplate>
                                        <DataTemplate>
                                            <TextBlock Height="35" HorizontalAlignment="Center" TextAlignment="Center" TextWrapping="Wrap"
                                                   Text="{Binding }" Margin="0,-4" />
                                        </DataTemplate>
                                    </dxg:TableView.ColumnHeaderTemplate>
                                    
                                </dxg:TableView>
                            </dxg:GridControl.View>

                            <dxg:GridControl.TotalSummary>
                                <dxg:GridSummaryItem FieldName="SiparisKalemKod" SummaryType="Count" />
                                <dxg:GridSummaryItem FieldName="KDVliToplam" SummaryType="Sum" DisplayFormat="{}{0:n2}" />
                                <dxg:GridSummaryItem FieldName="GenelToplamTutar" SummaryType="Sum" DisplayFormat="{}{0:n2}" />
                                <dxg:GridSummaryItem FieldName="Miktar_kg" SummaryType="Sum" DisplayFormat="{}{0:n0}" />
                            </dxg:GridControl.TotalSummary>

                            <dxg:GridControl.DetailDescriptor>

                                <dxg:DataControlDetailDescriptor ShowHeader="False" ItemsSourcePath="Paletler">
                                    <dxg:GridControl>

                                        <dxg:GridControl.TotalSummary>
                                            <dxg:GridSummaryItem DisplayFormat="S: {0:n0} " FieldName="Id" SummaryType="Count" />
                                            <dxg:GridSummaryItem FieldName="PaletNet_Kg" SummaryType="Sum" DisplayFormat=" {0:n0} kg   " />
                                           
                                        </dxg:GridControl.TotalSummary>


                                        <dxg:GridControl.View>
                                            <dxg:TableView ShowTotalSummary="True" ShowGroupPanel="False" 
                                                        >
                                               
                                            </dxg:TableView>
                                        </dxg:GridControl.View>


                                        <dxg:GridColumn Width="80" FieldName="Id" Header="Palet Id" />
                                        <dxg:GridColumn Width="80" FieldName="PaletNet_Kg" Header="Net Ağırlık" />
                                        <dxg:GridColumn Width="80" FieldName="DepoKabulTarihi" Header="Depoya Kabul T" />
                                        <dxg:GridColumn Width="80" FieldName="BobinlerBirlesik" Header="Bobinler" />

                                    </dxg:GridControl>
                                </dxg:DataControlDetailDescriptor>
                            </dxg:GridControl.DetailDescriptor>

                            <dxg:GridColumn AllowSorting="False" AllowColumnFiltering="False" MinWidth="40" Width="40" FieldName="SatirSecildiMi" Header="Seç">
                                <dxg:GridColumn.CellTemplate>
                                    <DataTemplate>
                                        <dxe:CheckEdit HorizontalAlignment="Center"
                                      IsChecked="{Binding Path=RowData.Row.SatirSecildiMi,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" />
                                    </DataTemplate>
                                </dxg:GridColumn.CellTemplate>
                            </dxg:GridColumn>

                            <dxg:GridColumn Visible="True" FieldName="SiparisKalemKod" />


                            <dxg:GridColumn Visible="{DXBinding Expr='SeciliSiparis.KapasitifMi==true'}"  
                                             FieldName="IlgiliSiparisKod">
                                <dxg:GridColumn.CellTemplate>
                                    <DataTemplate>
                                        <dx:SimpleButton Content="{Binding RowData.Row.IlgiliKalemKod}"
                                Command="{Binding View.DataContext.SiparisEditCommand}"
                                CommandParameter="{Binding RowData.Row.IlgiliKalemKod}"
                                                    Style="{StaticResource MyLinkButtonAc}" />
                                    </DataTemplate>
                                </dxg:GridColumn.CellTemplate>
                            </dxg:GridColumn>

                         
                            <dxg:GridColumn FieldName="LmeBaglamaKod" Header="Lme FixKod" Width="140" IsSmart="True" />
                            
                            <dxg:GridColumn Visible="False" FieldName="PlanlamaSevkOnayliMi" Width="120" />

                            <dxg:GridColumn Visible="True" FieldName="UrunKod" Header="Stok Kodu" Width="120" />

                            <dxg:GridColumn Visible="True" FieldName="MusteriUrunKodu" Header="Müş.Ürün Kodu" Width="120" />

                            <dxg:GridColumn Visible="False" FieldName="Id" Header="Id" Width="55" IsSmart="True" />

                           
                           

                            <dxg:GridColumn FieldName="AlasimTipKod" Header="Alaşım" IsSmart="True" />
                            <dxg:GridColumn FieldName="SertlikTipKod" Header="Sertlik" IsSmart="True" />
                            <dxg:GridColumn FieldName="AmbalajTipKod" Header="Ambalaj Tip" Visible="False" IsSmart="True" />

                            <dxg:GridColumn Width="115" Header="Kalınlık (µ)" FieldName="Kalinlik_micron" IsSmart="True">
                                <dxg:GridColumn.EditSettings>
                                    <dxe:TextEditSettings Mask="n1" DisplayFormat="n1" />
                                </dxg:GridColumn.EditSettings>
                            </dxg:GridColumn>
                            <dxg:GridColumn Header="En (mm)" FieldName="En_mm" IsSmart="True">
                                <dxg:GridColumn.EditSettings>
                                    <dxe:TextEditSettings Mask="n1" DisplayFormat="n1" />
                                </dxg:GridColumn.EditSettings>
                            </dxg:GridColumn>
                            <dxg:GridColumn Header="Miktar (kg)" FieldName="Miktar_kg" IsSmart="True">

                                <dxg:GridColumn.EditSettings>
                                    <dxe:TextEditSettings MaskType="Numeric" DisplayFormat="n0" />
                                </dxg:GridColumn.EditSettings>
                            </dxg:GridColumn>

                         
                    
                  
                            <dxg:GridColumn HeaderStyle="{StaticResource ResourceKey=fiyatColumnSitil}" FieldName="LmeTutar" Header="Lme Tutar">

                                <dxg:GridColumn.EditSettings>
                                    <dxe:TextEditSettings Mask="n1" DisplayFormat="n1" />
                                </dxg:GridColumn.EditSettings>
                            </dxg:GridColumn>

                            <dxg:GridColumn HeaderStyle="{StaticResource ResourceKey=fiyatColumnSitil}" FieldName="KulceTutar" Header="Külçe Tutar">

                                <dxg:GridColumn.EditSettings>
                                    <dxe:TextEditSettings Mask="n1" DisplayFormat="n1" />
                                </dxg:GridColumn.EditSettings>
                            </dxg:GridColumn>

                            <dxg:GridColumn HeaderStyle="{StaticResource ResourceKey=fiyatColumnSitil}" FieldName="IscilikTutar" Header="İşçilik Tutar" IsSmart="True">


                                <dxg:GridColumn.EditSettings>
                                    <dxe:TextEditSettings Mask="n1" DisplayFormat="n1" />
                                </dxg:GridColumn.EditSettings>
                            </dxg:GridColumn>

                            <dxg:GridColumn HeaderStyle="{StaticResource ResourceKey=fiyatColumnSitil}" FieldName="IscilikVadeFarkiTutar" Header="İşç.VF.Tut." IsSmart="True" UnboundType="Decimal">

                                <dxg:GridColumn.EditSettings>
                                    <dxe:TextEditSettings Mask="n1" DisplayFormat="n1" />
                                </dxg:GridColumn.EditSettings>
                            </dxg:GridColumn>


                            <dxg:GridColumn HeaderStyle="{StaticResource ResourceKey=fiyatColumnSitil}" FieldName="BirimFiyat" IsSmart="True">

                                <dxg:GridColumn.EditSettings>
                                    <dxe:TextEditSettings DisplayFormat="n2" />
                                </dxg:GridColumn.EditSettings>
                            </dxg:GridColumn>

                            <dxg:GridColumn MinWidth="40" HeaderStyle="{StaticResource ResourceKey=fiyatColumnSitil}" FieldName="ToplamTutar" IsSmart="True">


                                <dxg:GridColumn.EditSettings>
                                    <dxe:TextEditSettings Mask="n1" MaskType="Numeric" DisplayFormat="n1" />
                                </dxg:GridColumn.EditSettings>
                            </dxg:GridColumn>


                            <dxg:GridColumn HeaderStyle="{StaticResource ResourceKey=fiyatColumnSitil}" FieldName="KdvTutar" Header="Kdv Tutarı" IsSmart="True">

                                <dxg:GridColumn.EditSettings>
                                    <dxe:TextEditSettings Mask="n1" DisplayFormat="n1" />
                                </dxg:GridColumn.EditSettings>
                            </dxg:GridColumn>

                            <dxg:GridColumn MinWidth="40" HeaderStyle="{StaticResource ResourceKey=fiyatColumnSitil}" FieldName="GenelToplamTutar" Header="Genel T.">

                                <dxg:GridColumn.EditSettings>
                                    <dxe:TextEditSettings Mask="n1" DisplayFormat="n1" />
                                </dxg:GridColumn.EditSettings>
                            </dxg:GridColumn>

                            <dxg:GridColumn Style="{StaticResource MesajKolon}" MinWidth="50" Width="50" FieldName="MesajSayisi" Header="Mesaj" />
                        </dxg:GridControl>
                    </DockPanel>
                </materialDesign:Card>

                <materialDesign:Card DataContext="{Binding SeciliSiparis}" materialDesign:ShadowAssist.ShadowDepth="Depth0" Padding="8" Grid.Row="2">
                    <StackPanel Name="SiparişAltBilgi">

                        <StackPanel.Resources>
                            <Style TargetType="TextBlock">
                                <Setter Property="Width" Value="100" />
                                <Setter Property="TextAlignment" Value="Right" />
                                <Setter Property="Margin" Value="5,0,5,0" />
                            </Style>

                            <Style TargetType="DockPanel">
                                <Setter Property="Margin" Value="0,2" />
                            </Style>


                        </StackPanel.Resources>

                        <UniformGrid Rows="1">
                            <StackPanel Orientation="Vertical">

                                <DockPanel>
                                    <TextBlock Text="Ticari Özel Not" />
                                    <dxe:TextEdit NullText="Ticari Notlar" EditValue="{Binding OzelNot, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                </DockPanel>
                                <DockPanel>
                                    <TextBlock Text="Teknik Özellik" />
                                    <dxe:TextEdit EditValue="{Binding TeknikOzellikNot, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                </DockPanel>
                                <DockPanel>
                                    <TextBlock Text="Paketleme" />
                                    <dxe:TextEdit EditValue="{Binding PaketlemeNot, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                </DockPanel>

                                <DockPanel>
                                    <TextBlock Text="Firma İlgili Kişi" />
                                    <dxe:TextEdit NullText="Ad Soyad / Mail / Tel" EditValue="{Binding IlgiliNot, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                </DockPanel>

                                <DockPanel>
                                    <TextBlock Text="Panda Not" />
                                    <dxe:TextEdit NullText="Panda için  özel notları buraya giriniz.." EditValue="{Binding PandaNot, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                </DockPanel>
                            </StackPanel>
                            <StackPanel Orientation="Vertical">

                              

                                <DockPanel>
                                    <TextBlock Text="İrsaliye Adresi" />
                                    <dxe:TextEdit EditValue="{Binding IrsaliyeAdresi, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                </DockPanel>

                                <DockPanel>
                                    <TextBlock Text="İrsaliye Adresi2" />
                                    <dxe:TextEdit EditValue="{Binding IrsaliyeAdresi2, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                </DockPanel>

                                <DockPanel>
                                    <TextBlock Text="Fatura Adresi" />
                                    <dxe:TextEdit EditValue="{Binding FaturaAdresi, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                </DockPanel>


                                <DockPanel>
                                    <TextBlock Text="Teslim Şehir (loj) " />
                                    <dxe:TextEdit EditValue="{Binding Loj_TeslimSehir, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                </DockPanel>

                                <DockPanel>
                                    <TextBlock Text="Ödeme Vade (loj)" />
                                    <dxe:TextEdit EditValue="{Binding Loj_OdemeVade, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                </DockPanel>


                               
                            </StackPanel>
                        </UniformGrid>
                    </StackPanel>
                </materialDesign:Card>

            </Grid>
        </materialDesign:Card>

    </DockPanel>
</UserControl>